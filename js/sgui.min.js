"use strict";let sgUiVersion="4.00.03",debugSG=!1,defaultRelTarget="#main",sgBoxPage=0;console.log("SG-UI Version "+sgUiVersion+" loaded");let isAndroidWebViewReady="object"==typeof Android,isFlutterInAppWebViewReady=!1;function sgFindTargetElement(e,t){e="this"==e?t:"parent"==e?t.parent():e.match(/^parent /i)?t.closest(e.substring(7)):"before"==e?t.before():"after"==e?t.after():"prev"==e?t.prev():"next"==e?t.next():"box"==e?$("#cboxLoadedContent>.box-page").last():$(e);return e}function sgShowBox(e,t,a,o){var n,i={fixed:!0,opacity:.5,width:"95%",maxHeight:"95%",maxWidth:"95%",className:"colorbox"+("full"==t.data("width")?" -full":""),onComplete:function(){}},l=$("#cboxLoadedContent"),s=!1,r=window.scrollX,d=window.scrollY;a=$.extend(i,a),t instanceof jQuery&&(s=!0,n=t.attr("href")?t.attr("href"):t.attr("action"),t.data("className")&&t.data("className",a.className+" "+t.data("className")),a=$.extend(a,t.data(),t.data("box"))),"boxwidth"in a&&(a.width=a.boxwidth),"boxheight"in a&&(a.height=a.boxheight),a.clearBoxContent&&(sgBoxPage=0,l.empty()),a.onClosed=function(){sgBoxPage=0,window.onscroll=function(){},isAndroidWebViewReady&&Android.reloadWebView("Yes")},window.onscroll=function(){window.scrollTo(r,d)},s&&"img"===t.data("rel")?(sgBoxPage=0,s=t.data("group"),a.open=!0,$('.sg-action[data-group="'+s+'"]').each(function(e){$(this).colorbox(a)}),t.colorbox(a),o.stopPropagation()):l.length?(debugSG&&console.log("Show Link In Current Box"),debugSG&&console.log("Link Url =",n),l.find(".box-page").hide(),sgBoxPage++,o='<div class="box-page" data-page="'+sgBoxPage+'" data-url="'+n+'">'+e+"</div>",l.append(o)):(sgBoxPage++,a.html='<div class="box-page" data-page="'+sgBoxPage+'" data-url="'+n+'">'+e+"</div>",$.colorbox(a))}function sgUpdateData(e,t,a,o){var n,i,l;null!=t&&(l=(n=t.split(":"))[0],1<n.length&&(t=n[1]),debugSG&&console.log("Type = "+l+" Target = "+t),"none"==l||("console"==l?console.log(e):"notify"==l?notify("notify"!=t?t:e,2e4):"box"==l?(sgShowBox(e,a,{clearBoxContent:"clear"==t}),isAndroidWebViewReady&&Android.reloadWebView("No")):"close"==l?$.colorbox.close():"reload"==l?window.location=document.URL:"this"==l?a.html(e):"parent"==l?(i="parent"==t?a.parent():a.closest(t)).html(e):"replace"==l?(i="replace"==t?a:a.closest(t).length?a.closest(t):$(t)).replaceWith(e):"after"==l?(i="after"==t?a:$(t)).after(e):"append"==l?(i="append"==t?a:$(t)).append(e):"refresh"==l?(l=(i="refresh"==t?$("#main"):$(t)).data("url")?i.data("url"):document.URL)&&$.post(l,function(e){i.html(e)}):$(t).html(e)))}function sgActionDone(doneData,$this,data,options={}){void 0!==doneData&&doneData.split("|").map(function(doneItem){var doneExplode=doneItem.trim().split(":"),doneType=doneExplode[0].split("->")[0],doneAction=doneExplode[0].split("->")[1],doneTarget=1<doneExplode.length?doneExplode[1].trim():"",moveto;switch(""==doneTarget&&(doneTarget="#main"),doneType){case"notify":notify(doneExplode[1],2e4);break;case"javascript":eval(doneTarget);break;case"function":let fn="(function"+doneTarget+")($this,data)";eval(fn);break;case"callback":var callback=doneTarget.trim();doneTarget&&"function"==typeof window[doneTarget]&&window[doneTarget]($this,data);break;case"back":var $boxElement=$("#cboxLoadedContent"),$boxPage;$boxElement.length&&($boxPage=$(".box-page"),$boxPage.length<=1?($.colorbox.close(),isAndroidWebViewReady&&Android.reloadWebView("Yes")):($boxElement.children(".box-page").last().remove(),$boxElement.children(".box-page").last().show()));break;case"close":var $boxElement=$("#cboxLoadedContent");if($boxElement.length)$.colorbox.close();else{if(isFlutterInAppWebViewReady)return void window.flutter_inappwebview.callHandler("closeWebView");if(isAndroidWebViewReady)return Android.closeWebView(),!1}break;case"moveto":"#"===doneExplode[1].substr(0,1)?$(doneExplode[1]).length&&$("html,body").animate({scrollTop:$(doneExplode[1]).offset().top-64},"slow"):(moveto=doneExplode[1].split(","),window.scrollTo(parseInt(moveto[0]),parseInt(moveto[1])));break;case"remove":var $ele=sgFindTargetElement(doneTarget,$this);$ele.remove();break;case"reload":var refreshUrl=1<doneExplode.length?doneExplode[1]:document.URL,refreshUrl=refreshUrl.replace(/\{\{(\w+)\}\}/g,function(e,t){return data[t]});window.location=refreshUrl;break;case"load":var $ele=sgFindTargetElement(doneTarget,$this),loadUrl=2<doneExplode.length?doneExplode[2]:$ele.data("url")?$ele.data("url"):document.URL;loadUrl&&($ele.length||"none"==doneTarget)&&(loadUrl=loadUrl.replace(/\{\{(\w+)\}\}/g,function(e,t){return data[t]}),$.post(loadUrl,function(e){switch(doneAction){case"replace":$ele.replaceWith(e);break;case"before":$ele.before(e);break;case"after":$ele.after(e);break;case"append":$ele.append(e);break;case"prepend":$ele.prepend(e);break;case"prev":$ele.prev().html(e);break;case"next":$ele.next().html(e);break;case"clear":"box"==doneTarget&&sgShowBox(e,$this,{clearBoxContent:!0});break;default:$ele.html(e)}"box"==doneTarget&&$this.data("boxResize")&&$.fn.colorbox.resize({})}).fail(function(){console.log("Refresh url fail")}))}})}function sgWebViewDomProcess(e){e=$(e);sgActionDone(e.data("webviewResume"),e)}function drawChart(e){var o=$(e),n=o.attr("id"),i=o.find("h3").text(),l=o.data("chartType"),t=$(e).find("table"),s=[],r=[],d={},c={};null==l&&(l="col"),console.log("::SG-CHART "+l+" of "+n);e={pointSize:4,allowHtml:!0,pieHole:.4,vAxis:{viewWindowMode:"explicit"},hAxis:{textStyle:{fontSize:10}},annotations:{textStyle:{fontSize:9}}};2==o.data("series")&&(e.series={0:{targetAxisIndex:0},1:{targetAxisIndex:1}});d=$.extend(e,o.data("options"));o.data("value")||$.each(t.find("tbody>tr"),function(n,e){var t=$(this),i=[];$.each(t.find("td"),function(e,t){var a=$(this),o=a.attr("class").split(":");0==n&&r.push([o[0],o[1],null==o[2]?"":o[2]]),o="string"==o[0]?a.text():Number(a.text().replace(/[^\d\.]/g,"")),i.push(o),"guage"==l&&(c[a.attr("class")]=o)}),s.push(i)}),google.charts.load("current",{packages:["corechart","line","gauge"]}),google.charts.setOnLoadCallback(function(){i&&(d.title=i);let a=null;if(o.data("value"))a=google.visualization.arrayToDataTable(o.data("value"));else if("guage"==l){let t=[];t.push(["Label","Value"]),$.each(s,function(e){t.push([s[e][0],s[e][1]]),s[e][2]&&(d.max=s[e][2]),"redFrom"in c&&(d.redFrom=c.redFrom),"redTo"in c&&(d.redTo=c.redTo),"yellowFrom"in c&&(d.yellowFrom=c.yellowFrom),"yellowTo"in c&&(d.yellowTo=c.yellowTo),"greenFrom"in c&&(d.greenFrom=c.greenFrom),"greenTo"in c&&(d.greenTo=c.greenTo),"string:redColor"in c&&(d.redColor=c["string:redColor"])}),a=google.visualization.arrayToDataTable(t)}else a=new google.visualization.DataTable,$.each(r,function(e){"role"==r[e][2]?a.addColumn({type:r[e][0],role:"annotation"}):a.addColumn(r[e][0],r[e][1])}),a.addRows(s);var t,e=document.getElementById(n);"line"==l?t=new google.charts.Line(e):"bar"==l?t=new google.visualization.BarChart(e):"col"==l?t=new google.visualization.ColumnChart(e):"pie"==l?t=new google.visualization.PieChart(e):"combo"==l?t=new google.visualization.ComboChart(e):"guage"==l&&(t=new google.visualization.Gauge(e));!o.data("callback")||(e=o.data("callback"))&&"function"==typeof window[e]&&(e=window[e],google.visualization.events.addListener(t,"ready",e));o.data("image")&&google.visualization.events.addListener(t,"ready",function(){var e=t.getImageURI();document.getElementById(o.data("image")).src=e});t.draw(a,d)})}window.addEventListener("flutterInAppWebViewPlatformReady",function(e){isFlutterInAppWebViewReady=!0}),function(l){var s="0.01";l.fn.openWebview=function(e,t){var a=l(this),o=a.data(),n=a.attr("href"),i=a.data("webview");return self.doAction=function(){if(!isAndroidWebViewReady&&!isFlutterInAppWebViewReady)return!1;var e=JSON.stringify(o);if("browser"==i)isFlutterInAppWebViewReady||isAndroidWebViewReady&&Android.openBrowser(n,e);else if("googlemap"==i)isFlutterInAppWebViewReady||isAndroidWebViewReady&&Android.openGoogleMap(n,e);else if("server"==i)debugSG&&console.log("Change to Server to "+o.server),isFlutterInAppWebViewReady||isAndroidWebViewReady&&Android.useServer(o.server);else{if(!i)return!1;var t;o.webviewTitle=o.webview,e=JSON.stringify(o),n=/^((http|https|ftp):\/\/)/.test(n)?n:document.location.origin+n,isFlutterInAppWebViewReady?(t=[n,o.webviewTitle,o],window.flutter_inappwebview.callHandler("showWebView",...t)):isAndroidWebViewReady&&Android.showWebView(n,e)}},a.actionComplete=!1!==self.doAction(),a.version=function(){return console.log("$.sgAction version is "+s),a},a},l(document).on("click","[data-webview]",function(e){var t=l(this).openWebview(e,{}).actionComplete;return debugSG&&console.log("Mobile App WebView 0.01 result is ",t),!t||(e.stopImmediatePropagation(),!1)})}(jQuery),function(m){var v="1.01";m.fn.sgAction=function(a,e={}){var o,n,i=m(this),l=i.data(),t=l.options,s=i.attr("href"),r=l.rel,d=l.ret,c={},u=m("#cboxLoadedContent"),p=null==l.confirm||l.confirmed,g=l.callback;"javascript:void(0)"==s&&(s=l.url),console.log("$.sgAction version 1.01 start"),r&&(o=r.split("->")[1],r=r.split("->")[0]);var f={result:"html",container:m(this),loadurl:l.loadurl,silent:!1,callback:!1},h=m.extend({},m.fn.sgAction.defaults,f,t,e);return self.doAction=function(){if(console.log("relTarget = "+r+" Action = "+o),p){if(l.confirmed&&(i.removeData("confirmed"),c.confirm="yes"),"box"==r&&"clear"==o&&(sgBoxPage=0,u.empty()),l.before&&sgActionDone(l.before,i),"close"==r){if(0!=i.closest(".sg-dropbox.box").length)return m(".sg-dropbox.box").children("div").hide(),void m(".sg-dropbox.box.active").removeClass("active");if(m("#cboxLoadedContent").length)return void m.colorbox.close();if(isFlutterInAppWebViewReady)return void window.flutter_inappwebview.callHandler("closeWebView");if(isAndroidWebViewReady)return void Android.closeWebView();r=void 0}else{if("back"==r&&u.length)return void(m(".box-page").length<=1?(m.colorbox.close(),isAndroidWebViewReady&&console.log("ANDROID Back")):(u.children(".box-page").last().remove(),u.children(".box-page").last().show()));if("img"==r)return void sgShowBox(null,i,null,a)}if(null==r&&null==d){var e="{}"!=JSON.stringify(c),t=i.attr("href");return t+=e?(-1==t.indexOf("?")?"?":"&")+m.param(c):"",window.location=t,!0}if(s&&"#"==s.substr(0,1)){console.log("LOAD FROM DOM "+s);t=null;return m(s).length&&(t=m(s).get(0).innerHTML),sgUpdateData(t,r,i),void sgActionDone(l.done,i,n)}debugSG&&console.log("Load from url "+s),h.silent||notify(h.indicator),m.post(s,c,function(e){var t;n=e,notify(),h.silent||console.log("Load completed."),d?(debugSG&&console.log("Return URL "+d),m.post(d,function(e){sgUpdateData(e,r,i),notify()})):sgUpdateData(e,r,i),l.removeparent&&((t=l.removeparent).charAt(0).match(/\.|\#/i)?m(t):i.closest(t)).remove(),h.callback&&h.callback(i,e),g&&"function"==typeof window[g]?window[g](i,e):g&&(window.location=g)}).fail(function(e){let t="ERROR : ";e.responseJSON.text?t+=e.responseJSON.text+" ("+e.status+")":t+=e.statusText+" ("+e.status+")",notify(t)}).done(function(){sgActionDone(l.done,i,n)})}},self.test=function(){console.log("THIS IS A TEST")},i.actionResult=!1!==self.doAction(),i.version=function(){return console.log("$.sgAction version is "+v),i},i},m.fn.sgForm=function(){return this},m.fn.sgAction.defaults={indicator:"LOADING",tooltip:"คลิกเพื่อแก้ไข",cssclass:"inlineedit",width:"none",height:"none",cancelcssclass:"btn -link -cancel",submitcssclass:"btn -primary",showButtonPanel:!0,event:"edit",inputcssclass:""},m(document).on("click",".sg-action",function(e){return!m(this).sgAction(e,{aTestOpt:"This is test option"}).actionResult})}(jQuery),$(document).on("submit","form.sg-form",function(a){var o,n=$(this),i=n.data("rel"),l=n.data("ret"),s=n.data("complete"),e=n.data("checkvalid"),t=n.data("silent"),r="",d="";return console.log("sg-form :: Submit"),(!e||(console.log("Form Check input valid start."),n.find(".require, .-require").each(function(e){var t=$(this);if("text"!=t.attr("type")&&"password"!=t.attr("type")&&"hidden"!=t.attr("type")&&"TEXTAREA"!=t.prop("tagName")||""!=t.val().trim()?"SELECT"!=t.prop("tagName")||0!=t.val()&&-1!=t.val()&&""!=t.val()?"radio"!=t.attr("type")&&"checkbox"!=t.attr("type")||$("input[name='"+t.attr("name")+"']:checked").val()||(d=(r=t).closest("div").children("label").first().text()):(r=t,d='กรุณาเลือกข้อมูลในช่อง " '+$("label[for="+r.attr("id")).text()+' "'):(r=t,d='กรุณาป้อนข้อมูลในช่อง " '+$("label[for="+r.attr("id")).text()+' "',t.focus()),r){t=r.attr("id");return $("#"+t).isOnScreen()||$("html,body").animate({scrollTop:r.offset().top-100},"slow"),notify(d),!1}}),!r))&&(null==i||(t||notify("PROCESSING"),debugSG&&console.log("Send form to "+n.attr("action")),debugSG&&console.log("Result to "+i),n.hasClass("-upload")?(debugSG&&console.log("SOFTGANZ UPLAOD FILE"),n.ajaxSubmit({success:function(e){debugSG&&console.log("SG-FORM.-UPLOAD ajaxSubmit upload file complete."),"remove"==s?n.remove():"close"!=s&&"closebox"!=s||(0!=$(a.rel).closest(".sg-dropbox.box").length?($(".sg-dropbox.box").children("div").hide(),$(".sg-dropbox.box.active").removeClass("active")):$.colorbox.close()),l?$.post(l,function(e){sgUpdateData(e,i,n),notify(),sgActionDone(n.data("done"),n,e)}):(sgUpdateData(e,i,n),sgActionDone(n.data("done"),n,e)),"notify"!=i&&notify(),n.replaceWith(n.clone(!0))},error:function(e){notify(e.statusText),debugSG&&console.log(e),sgUpdateData(e.responseText,i,n)}})):$.post(n.attr("action"),n.serialize(),function(e){o=e,debugSG&&console.log("Form submit completed and send output to "+i),"remove"==s?n.remove():"close"!=s&&"closebox"!=s||(0!=$(a.rel).closest(".sg-dropbox.box").length?($(".sg-dropbox.box").children("div").hide(),$(".sg-dropbox.box.active").removeClass("active")):$.colorbox.close()),l?(debugSG&&console.log("Return URL "+l),$.post(l,function(e){sgUpdateData(e,i,n),notify()})):(sgUpdateData(e,i,n),n.data("moveto")&&(t=n.data("moveto").split(","),window.scrollTo(parseInt(t[0]),parseInt(t[1])))),"notify"!=i.substring(0,6)&&notify();var t=n.data("callback");t&&"function"==typeof window[t]?window[t](n,e):t&&(window.location=t)},null==n.data("dataType")?null:n.data("dataType")).fail(function(e){let t="ERROR : ";return e.responseJSON.text?t+=e.responseJSON.text+" ("+e.status+")":t+=e.statusText+" ("+e.status+")",notify(t),debugSG&&console.log(e),!1}).done(function(e){sgActionDone(n.data("done"),n,o)}),!1))}).on("keydown","form.sg-form input:text",function(e){var t=$(this).closest("form").find("input:text"),a=t.length;if(13==e.keyCode){e.preventDefault();e=t.index(this)+1;return e<a&&t[e].focus(),!1}}),function(c){var u,p=0,g=0;c.fn.sgInlineEdit=function(t,o={}){if(void 0!==c.fn.editable){if("disable"!==t&&"enable"!==t&&"destroy"!==t){let a=c(this),i=a.closest(".sg-inline-edit");var l=i.data("updateUrl");let e=a.data("type");var n=a.data("callback");if(u=!!i.data("debug"),"money"==e||"numeric"==e||"text-block"==e)e="text";else if("radio"==e||"checkbox"==e)var s=a.is(":checked")?a.val():"";else{if("link"==e)return;""!=e&&null!=e||(e="text",a.data("type","text"))}var r={type:e,result:"json",container:c(this),onblur:a.data("onblur")?a.data("onblur"):"submit",data:function(e,t){return a.data("data")?a.data("data"):null!=a.data("value")?a.data("value"):"..."==e?"":e},loadurl:a.data("loadurl"),before:function(){var e=a.data("options"),e=null!=e&&e.hasOwnProperty("onBefore")?e.onBefore:null;e&&"function"==typeof window[e]&&window[e](a,i)},cancel:"yes"==c(this).data("button")?'<button class="btn -link -cancel"><i class="icon -cancel -gray"></i><span>ยกเลิก</span></button>':null,submit:"yes"==c(this).data("button")?'<button class="btn -primary"><i class="icon -save -white"></i><span>บันทึก</span></button>':null,placeholder:c(this).data("placeholder")?c(this).data("placeholder"):"..."},t=a.data("options"),d=c.extend({},c.fn.sgInlineEdit.defaults,r,o,t);return"textarea"==a.data("type")?d.inputcssclass="form-textarea":"text"==a.data("type")?d.inputcssclass="form-text":"numeric"==a.data("type")?d.inputcssclass="form-text -numeric":"money"==a.data("type")?d.inputcssclass="form-text -money":"email"==a.data("type")?d.inputcssclass="form-text -email":"url"==a.data("type")?d.inputcssclass="form-text -url":"autocomplete"==a.data("type")?d.inputcssclass="form-text -autocomplete":"select"==a.data("type")&&(d.inputcssclass="form-select"),a.editable(function(e,t){return _validValue(a,e)?(self.save(a,e,n),e):(notify("ข้อมูลไม่อยู่ในช่วงที่กำหนด"),a.data("value"))},d).trigger("edit"),self._validValue=function(e,t){return"numeric"!=e.data("ret")||(t=t.replace(/[^0-9.\-]+|\.(?!\d)/g,""),!(null!=e.data("minValue")&&+t<+e.data("minValue"))&&!(null!=e.data("maxValue")&&+t>+e.data("maxValue")))},self.save=function(o,e,t){if(void 0===l)return console.log("POSTURL UNDEFINED"),void notify("ข้อมูลปลายทางสำหรับบันทึกข้อมูลผิดพลาด");var n=c.extend({},i.data(),o.data());delete n.options,delete n.data,delete n["event.editable"],delete n.uiAutocomplete,n.action="save",n.value=e.replace(/\"/g,'"'),d.var&&(n[d.var]=n.value),o.data("value",n.value),p++,g++,notify("กำลังบันทึก กรุณารอสักครู่...."+(u?"<br />Updating : pending = "+p+" To = "+l+"<br />":"")),i.find(".inline-edit-field").addClass("-disabled"),c.post(l,n,function(e){var t;p--,i.find(".inline-edit-field").removeClass("-disabled"),"string"==typeof e&&(t=e,(e={}).value=n.value,u&&(e.msg=t)),"refresh"==n.ret?window.location=window.location:"autocomplete"==o.data("type")?(o.data("value",n.value),o.html("<span>"+e.value+"</span>")):"radio"==o.data("type")||"checkbox"==o.data("type")||("select"==o.data("type")?(a=o.data("data")?o.data("data")[e.value]:e.value,o.html("<span>"+a+"</span>")):o.html("<span>"+(null==e.value?'<span class="placeholder -no-print">'+d.placeholder+"</span>":e.value)+"</span>"));var a="";n.tr!=e.tr&&(0==e.tr&&(e.tr=""),c('[data-group="'+n.group+'"]').data("tr",e.tr),a="Replace tr of group "+n.group+" with "+e.tr),notify((e.error||e.msg||"")+(u&&e.debug?'<div class="-sg-text-left" style="white-space: normal;">Update queue = '+g+", Update pending = "+p+"<br />PARAMETER : group = "+n.group+", FIELD = "+n.fld+", TRAN = "+n.tr+", VALUE = "+e.value+"<br />DEBUG : "+e.debug+"<br />Return : TRAN = "+e.tr+"<br />"+a+"</div>":""),u?3e5:5e3)},d.result).fail(function(e){notify("ERROR ON POSTING. Please Contact Admin.")}).done(function(e){var t=d.callback||o.data("callback");debugSG&&console.log("CALLBACK ON COMPLETE -> "+t+(t?"()":"")),t&&("function"==typeof window[t]?window[t](o,e,i):"silent"==d.callbackType?c.get(t,function(){}):window.location=t),d.done&&sgActionDone(d.done,o,e),console.log("$.sgInlineEdit DONE!!!")})},"radio"!=e&&"checkbox"!=e||self.save(a,s,n),{getVersion:function(){return"1.01"},update:function(e,t,a){self.save(e,t,a)}}}}else console.log("ERROR :: $.editable is not load")},c.fn.sgInlineEdit.defaults={indicator:'<div class="loader -rotate"></div>',indicator:"SAVING",tooltip:"คลิกเพื่อแก้ไข",cssclass:"inlineedit",width:"none",height:"none",var:null,cancelcssclass:"btn -link -cancel",submitcssclass:"btn -primary",showButtonPanel:!0,event:"edit",inputcssclass:"",autocomplete:{},datepicker:{}},c(document).on("click",".sg-inline-edit .inline-edit-field:not(.-readonly)",function(){console.log("$.sgInlineEdit version 1.01 start"),c(this).sgInlineEdit()}),c(document).on("keydown",".sg-inline-edit .inline-edit-field",function(e){if(9==e.keyCode){c(this).closest(".sg-inline-edit");var t="",e=c(".inline-edit-field").index(this),t=e==c(".inline-edit-field").length-1?c(".inline-edit-field:first"):c(".inline-edit-field").eq(e+1);return c(this).find("input").blur(),c(t).trigger("click"),!1}}),c(document).ready(function(){void 0!==c.fn.editable&&(c.editable.addInputType("checkbox",{}),c.editable.addInputType("radio",{}),c.editable.addInputType("autocomplete",{element:c.editable.types.text.element,plugin:function(i,l){c(l).attr("autocomplete","off");var e={target:"",source:function(e,t){var a=i.autocomplete.query,o={};o.q=e.term,c.get(a,o,function(e){t(c.map(e,function(e){return e}))},"json")},minLength:2,dataType:"json",cache:!1,focus:function(e,t){e.preventDefault()},select:function(e,t){this.value=t.item.label;var a=i.autocomplete.target;if(console.log("targetValue",a),a)for(var o in"string"==typeof a&&(a=JSON.parse('{"'+a+'": "value"}')),a){var n=t.item[a[o]];console.log("key = "+o+" , value = item.ui."+n),"#"==o.substring(0,1)||"."==o.substring(0,1)?c(o).val(t.item.value):(c(l).data(o,n),console.log("data of key "+o+" = "+c(l).data(o)))}c(this).submit()}};i.autocomplete=c.extend({},e,i.autocomplete),c("input",this).autocomplete(i.autocomplete).autocomplete("instance")._renderItem=function(e,t){return("..."==t.value?c('<li class="ui-state-disabled -more"></li>').append(t.label):c("<li></li>").append("<a><span>"+t.label+"</span>"+(null!=t.desc?"<p>"+t.desc+"</p>":"")+"</a>")).appendTo(e)}}}),c.editable.addInputType("datepicker-old",{element:function(e,t){var a=c('<input class="form-text -datepicker" />');return a.attr("autocomplete","off"),e.datepicker?a.datepicker(e.datepicker):a.datepicker(),e.datepicker.format&&a.datepicker("option","dateFormat",e.datepicker.format),c(this).append(a),a},submit:function(e,t){var a=c("input",this).datepicker("getDate"),a=e.datepicker.format?c.datepicker.formatDate(e.datepicker.format,new Date(a)):a;c("input",this).val(a)},plugin:function(e,t){e.onblur="submit"}}),c.editable.addInputType("datepicker",{element:function(e,t){var a=c('<input class="form-text -datepicker" />');a.attr("autocomplete","off");var o={format:"dd/mm/yy",monthNames:thaiMonthName,beforeShow:function(e){console.log("INLINE DATE BEFORE SHOW"),c(".ui-datepicker:visible").css({top:"+=5"})},open:function(){console.log("INLINE DATEOPEN"),c(".ui-datepicker:visible").css({top:"+=5"})},onSelect:function(){c(this).submit()}};return e.datepicker=c.extend({},o),a.datepicker(e.datepicker),e.datepicker.format&&a.datepicker("option","dateFormat",e.datepicker.format),c(this).append(a),a},submit:function(e,t){var a=c("input",this).datepicker("getDate"),a=e.datepicker.format?c.datepicker.formatDate(e.datepicker.format,new Date(a)):a;c("input",this).val(a),c("input",this).datepicker("hide")},plugin:function(e,t){e.onblur="nothing"}}))})}(jQuery),function(a){a(document).on("click",".sg-expand",function(){let e=a(this),t=a(this).children();if(e.data("rel"))a(e.data("rel")).toggle();else{let e=a(this).closest(".widget-listtile");e.next().toggle()}"expand_less"==t.text()?t.text("expand_more"):"expand_more"==t.text()&&t.text("expand_less")})}(jQuery),function(c){var u="0.10";let l=0;c.fn.sgDrawReport=function(e,t={}){let a=c(this),o=a.closest("form"),s=a.closest(".sg-drawreport");var n=s.data("query"),i=s.data("callback"),l=s.data("options");console.log("$.sgDrawReport version 0.10 init");var r={dataType:"json",container:c(this),callback:!1},d=c.extend({},c.fn.sgDrawReport.defaults,r,l,t);return self.startDrawReport=function(a){console.log("$.sgDrawReport 0.10 start draw report");0<s.find('input[name="debug"]:checked').length&&a.process;if("html"!=d.dataType){let t=s.find("#report-output-debug").empty();a.debug&&a.process&&a.process.forEach(function(e){t.append(c("<div></div>").html(e))}),s.data("showChart")&&showChart(a),s.data("showSummary")&&showSummary(a),s.data("showItems")&&showItems(a),s.data("showHtml")&&showHtml(a)}else{let e=c(s.data("showHtml"));e.html(a)}},self.showChart=function(e){var t=c(s.data("showChart")),a=s.find("#graphtype").val();let o=[["รายการ","จำนวน"]];null!=e.summary&&0!=t.length&&(e.summary.forEach(function(e,t){o.push([e.label,e.project])}),t=google.visualization.arrayToDataTable(o),e={title:e.title,hAxis:{title:"H Axis",titleTextStyle:{color:"black"}},vAxis:{title:"Y Axis",minValue:0},isStacked:!1},new("Bar"==a?google.visualization.BarChart:"Col"==a?google.visualization.ColumnChart:"Line"==a?google.visualization.LineChart:google.visualization.PieChart)(document.getElementById("report-output-chart")).draw(t,e))},self.showSummary=function(t){var n,a,o,e=c(s.data("showSummary"));e.empty(),null!=t.summary&&0!=e.length&&(n=c("<table></table>").addClass("item"),a=c("<thead></thead>"),Object.keys(t.summaryFields).forEach(function(e){a.append(c("<th></th>").text(t.summaryFields[e]))}),n.append(a),t.summary.forEach(function(a,e){var o=c("<tr></tr>").addClass("row");Object.keys(t.summaryFields).forEach(function(e){let t=a[e];"number"==typeof t&&parseInt(t)!=t&&(t=thousandsSeparators(t)),o.append(c("<td></td>").addClass("col "+("label"==e?"":"-center")).text(t))}),n.append(o)}),t.total&&(o=c("<tfoot></tfoot").append(c("<tr></tr>")),Object.keys(t.summaryFields).forEach(function(e){"label"==e?o.append("<td>รวมทั้งสิ้น</td>"):"%"==t.summaryFields[e]?o.append(c("<td></td>").addClass("col -center").text("100%")):o.append(c("<td></td>").addClass("col -center").text(t.total[e]))}),n.append(o)),e.append(n))},self.showItems=function(i){let e=c(s.data("showItems"));var t,a,l;e.empty(),null!=i.items&&0!=e.length&&0<i.items.length&&((t=c("<a/>")).addClass("btn").html('<i class="icon -material">cloud_download</i><span>EXPORT</span>').attr("href","javascript:void(0)").attr("onClick",'export2excel("trans")'),e.append(c("<nav></nav>").addClass("nav -page -table-export -sg-text-right").append(t)),t=c("<table></table>").addClass("item").attr("id","detail-list"),a=c("<thead></thead>").append(c("<tr></tr>")),Object.keys(i.itemsFields).forEach(function(e){a.append(c("<th></th>").text(i.itemsFields[e]))}),t.append(a),l=c("<tbody></tbody>"),i.items.forEach(function(t,e){let a=c("<tr></tr>").addClass("row"),o=c("<a/>"),n;"object"==typeof t.config.link&&(n=t.config.link.field,o.attr("href",t.config.link.href).text(t[t.config.link.field]).addClass("sg-action").attr("target","_blank").data("rel","box").data("width",640).data("webview",t.fullname)),Object.keys(i.itemsFields).forEach(function(e){a.append(c("<td></td>").html(e==n?o:t[e]))}),l.append(a)}),t.append(l),e.append(t))},self.showHtml=function(e){let t=c(s.data("showHtml"));t.empty(),null!=e.html&&t.html(e.html)},a.doAction=function(){return a.hasClass("-submit-group")?(a.closest("ul").children().removeClass("-active"),a.closest("li").addClass("-active"),c("#reporttype").val(a.attr("href").slice(1))):a.hasClass("-graph")&&c("#graphtype").val(a.val()),notify("LOADING"),c.post(n,o.serialize(),function(e){notify()},d.dataType).fail(function(e){notify("ERROR ON POSTING")}).done(function(e){debugSG&&e.debug&&console.log("DONE WITH data = ",e),i&&"function"==typeof window[i]?window[i](a,e):startDrawReport(e)}),null!=e&&"checkbox"!=c(e.target).attr("type")&&e.preventDefault(),a},a.showChart=function(e){return showChart(e),a},a.showSummary=function(e){return showSummary(e),a},a.showItems=function(e){return showItems(e),a},a.showHtml=function(e){return showHtml(e),a},a.version=function(){return console.log("$.sgDrawReport version is "+u),a},a.makeFilterBtn=function(){let t=s.find("#toolbar-report-filter>.-item");t.empty(),c(".sg-drawreport .-filter-checkbox:checked").each(function(e){t.append('<span class="" data-src="'+c(this).attr("id")+'">'+c(this).closest("label").text()+'<a class="x-submit"><i class="icon -material -sg-16">close</i></a></span>')})},a},c.fn.sgDrawReport.defaults={indicator:"LOADING"},c(document).on("click",".sg-drawreport>form>.toolbar.-report>.-filter>.-select>.-item a",function(){var e=c(this).closest("span").data("src");c("#"+e).prop("checked",!1);let t=c("#"+e).closest("li").find(".-amt");t.html(t.text()-1);c(this).sgDrawReport(event,{aTestOption:"This is test option"}).doAction();c(this).parent().remove()}),c(document).on("click",".sg-drawreport .-submit",function(e){return c(this).sgDrawReport(e,{aTestOption:"This is test option"}).doAction()}),c(document).on("change",".sg-drawreport .-filter-checkbox",function(){let t=0;c(this).closest(".-checkbox").find(".-filter-checkbox:checked").each(function(e){t++}),c(this).closest("li").find(".-check-count>.-amt").html(t).parent().removeClass("-hidden").addClass(0<t?"":"-hidden"),c(this).sgDrawReport().makeFilterBtn()}),c(document).on("click",".sg-drawreport .group-nav",function(){let e=c(this);var t=e.hasClass("-left");let a=e.closest(".-group");var o=a.width()-60,n=a.find("ul>li").width(),i=Math.floor(o/n),o=Math.ceil(a.find("ul").width()/o);t?0<l&&l--:l<o-1&&l++;i=l*n*i+(i*l+1)-1;a.find("ul").animate({left:-i+"px"},"fast")})}(jQuery),$(document).on("click",".sg-tabs>.ui-tab>.ui-item>a, .sg-tabs>ul.tabs>li>a, .sg-tabs>ul>li>a",function(e){var t=$(this),a=t.closest(".sg-tabs"),o=t.attr("href");if(t.closest("ul").children("li").removeClass("-active"),t.closest("li").addClass("-active"),sgTabIdActive=t.attr("id"),null!=t.attr("target"))return!0;null==o||"javascript:void(0)"==o||("#"==o.left(1)?(a.children("div").hide(),a.children(t.attr("href")).show()):t.hasClass("sg-action")||(notify("LOADING"),console.log("LOAD TAB"),$.post(o,function(e){a.children("div").html(e),notify()})));o=t.data("callback");return o&&"function"==typeof window[o]?window[o](t,html):o&&(window.location=o),!1}),$(document).on("click",".sg-dropbox>a",function(){var e=$(this).parent(),t=$(this).next(),a=e.find(".sg-dropbox--content");$(".sg-dropbox.click").not($(this).parent()).each(function(){$(this).children("div").hide()}),"box"==e.data("type")?(e.css("display","block").addClass("active"),null!=e.data("url")?(a.html("LOADING"),t.show(),$.get(e.data("url"),function(e){a.html(e)})):t.show()):"click"==e.data("type")?t.show():t.toggle();var o=$(this).offset(),n=t.width(),i=$(document).width(),e=0;return o.left+n>i&&(e=i-o.left-$(this).width()-8,t.css({rightside:e+"px"})),!1}).on("click","body",function(e){0==$(e.target).closest(".sg-dropbox").length&&$(".sg-dropbox.click").children("div").hide(),0===$(e.target).closest(".sg-dropbox.box").length&&($(".sg-dropbox.box").children("div").hide(),$(".sg-dropbox.box.active").removeClass("active"))}),$(document).on("focus",".sg-datepicker",function(e){console.log("SG-DATEPICKER Start"),$(this).attr("autocomplete","off");var t={clickInput:!0,dateFormat:"dd/mm/yy",altFormat:"yy-mm-dd",altField:"AAAA",disabled:!1,monthNames:thaiMonthName,beforeShow:function(e){$(this).data("previous",$(e).val()),$(".ui-datepicker:visible").css({top:"+=5"})},open:function(){},onSelect:function(n,e){if($(this).data("previous")!=n){if($(this).data("diff")){let o=$("#"+$(this).data("diff")),e=$(this);if(""==o.val())o.val(e.val());else{var i=0;let e=$(this).data("previous")?$(this).data("previous"):n;var l=e.split("/"),s=$(this).val().split("/"),r=o.val().split("/"),l=new Date(l[2],l[1]-1,l[0]),r=new Date(r[2],r[1]-1,r[0]);let t=new Date(s[2],s[1]-1,s[0]);i=Math.round((r-l)/864e5);let a=new Date(t);a.setDate(t.getDate()+i);r=a.getDate(),l=a.getMonth()+1,i=a.getFullYear(),i=("00"+r).slice(-"00".length)+"/"+("00"+l).slice(-"00".length)+"/"+i;o.val(i)}}$(this).trigger("dateupdated")}i=$(this).data("callback");i&&("submit"==i?$(this).closest("form").submit():"function"==typeof window[i]?window[i](n,$(this)):(i=i+"/",window.location=i))}},t=$.extend(t,$(this).data());$(this).datepicker(t)}),$(document).on("focus",".sg-address",function(e){var o=$(this);o.autocomplete({source:function(e,t){console.log("Search address of "+e.term),$.get(url+"api/address?q="+encodeURIComponent(e.term),function(e){t(e)},"json")},minLength:6,dataType:"json",cache:!1,select:function(e,t){this.value=t.item.label,console.log("Return Address : "+t.item.value),o.data("altfld")&&$("#"+o.data("altfld")).val(t.item.value);var a=o.data("callback");return a&&("submit"==a?$(this).closest("form").trigger("submit"):"function"==typeof window[a]?window[a](o,t):(t=a+"/"+t.item.value,window.location=t)),!1}}).autocomplete("instance")._renderItem=function(e,t){return("..."==t.value?$('<li class="ui-state-disabled -more"></li>').append(t.label):$("<li></li>").append("<a><span>"+t.label+"</span>"+(null!=t.desc?"<p>"+t.desc+"</p>":"")+"</a>")).appendTo(e)}}),$(document).on("focus",".sg-autocomplete",function(e){var i=$(this),l=i.closest("form"),t=1;i.data("minlength")&&(t=i.data("minlength")),i.autocomplete({minLength:t,dataType:"json",cache:!1,source:function(e,t){var a={};a.n=i.data("item"),a.q=i.val(),notify("กำลังค้นหา"),$.get(i.data("query"),a,function(e){notify(),t(e);e=i.data("renderComplete");if(e&&"function"==typeof window[e])return window[e](i)},"json")},open:function(){$(".ui-autocomplete:visible").css({top:"+=5"}),i.data("class")&&i.autocomplete("widget").addClass(i.data("class")),i.data("width")&&i.autocomplete("widget").css({width:i.data("width")})},focus:function(e,t){return!1},select:function(e,t){if(i.data("altfld")&&(n="#"+i.data("altfld"),(l.find(n).length?l.find(n):$(n)).val(t.item.value)),null!=i.data("select")){var a,o=i.data("select");if("object"==typeof o)for(a in o)$("#"+a).val(t.item[o[a]]);else"string"==typeof o&&i.val(t.item[o])}else i.val(t.item.label);var n=i.data("callback");return n&&("submit"==n?$(this).closest("form").trigger("submit"):"function"==typeof window[n]?window[n](i,t):(n=n+"/"+t.item.value,window.location=n)),!1},response:function(e,t){var a=i.data("renderStart");a&&"function"==typeof window[a]&&window[a](i,t)}}).autocomplete("instance")._renderItem=function(e,t){var a=i.data("renderItem");return a&&"function"==typeof window[a]?window[a](i,e,t):("..."==t.value?$('<li class="ui-state-disabled -more"></li>').append(t.label):$("<li></li>").append("<a><span>"+(null!=t.altLabel?t.altLabel:t.label)+"</span>"+(null!=t.desc?"<p>"+t.desc+"</p>":"")+"</a>")).appendTo(e)}}),$(document).on("change","form.sg-upload .inline-upload",function(){var e,t,a,o=$(this),n=o.closest("form"),i=n.data("rel"),l=' class="'+(null!=n.data("class")?n.data("class"):"ui-item -hover-parent")+'"';isAndroidWebViewReady&&Android.showToast("กำลังอัพโหลดไฟล์"),console.log("sg-upload :: Inline upload file start and show result in "+i),n.data("before")?(t="<"+(e=n.data("before"))+l+'><div class="loader -rotate -center"></div></'+e+">",a=o.closest(e).before(t),console.log(a)):notify('<div class="loader -rotate"></div> กำลังอัพโหลดไฟล์ กรุณารอสักครู่'),n.ajaxForm({success:function(e){var t;console.log("Inline upload file complete."),isAndroidWebViewReady&&Android.showToast("อัพโหลดไฟล์เรียบร้อบ"),i&&(n.data("append")?(t="<"+n.data("append")+l+">"+e+"</"+n.data("append")+">",$(i).append(t)):n.data("prepend")?(t="<"+n.data("prepend")+l+">"+e+"</"+n.data("prepend")+">",$(i).prepend(t)):n.data("before")?a.prev().html(e):n.data("after")?(t="<"+n.data("after")+l+">"+e+"</"+n.data("after")+">",o.closest(n.data("after")).after(t)):sgUpdateData(e,i,o)),notify("ดำเนินการเสร็จแล้ว.",5e3),o.val(""),o.replaceWith(o.clone(!0)),"close"==n.data("done")&&$.colorbox.close()}}).submit()}),$(document).ready(function(){$(".sg-chart").each(function(e){drawChart(this)})}),$(document).on("change",".sg-changwat",function(){var e=$(this),t=e.closest("form"),a=(t.find(".sg-changwat"),t.find(".sg-ampur")),o=t.find(".sg-tambon"),n=t.find(".sg-village"),i=e.data("altfld");console.log("Get Ampur of "+e.val()),""==e.val()?a.val("").hide():a.val(""),o.val("").hide(),n.length&&n.val("").hide(),a.length&&(a[0].options.length=1),o.length&&(o[0].options.length=1),n.length&&(n[0].options.length=1),i&&t.find(i).val(e.val()),$.get(url+"api/ampur",{q:e.val()},function(e){e.length?a.show():a.hide();for(var t=0;t<e.length;t++)a.append($("<option></option>").text(e[t].label).val(e[t].ampur))},"json"),"submit"==e.data("change")&&t.submit()}),$(document).on("change",".sg-ampur",function(){var e=$(this),t=e.closest("form"),a=t.find(".sg-changwat"),o=t.find(".sg-ampur"),n=t.find(".sg-tambon"),i=t.find(".sg-village"),l=e.data("altfld");console.log("Get Tambon of "+e.val()),""==e.val()?n.val("").hide():n.val(""),i.val("").hide(),n.length&&(n[0].options.length=1),i.length&&(i[0].options.length=1),l&&t.find(l).val(a.val()+e.val()),$.get(url+"api/tambon",{q:a.val()+o.val()},function(e){e.length?n.show():n.hide();for(var t=0;t<e.length;t++)n.append($("<option></option>").text(e[t].label).val(e[t].tambon))},"json"),"submit"==e.data("change")&&t.submit()}),$(document).on("change",".sg-tambon",function(){let e=$(this),t=e.closest("form"),a=t.find(".sg-changwat"),o=t.find(".sg-ampur"),n=t.find(".sg-tambon"),i=t.find(".sg-village");var l=e.data("altfld");l&&(console.log("tambon altfld = "+l),t.find(l).val(a.val()+o.val()+e.val())),i.length&&(console.log("Get Village of "+e.val()),""==e.val()?i.val("").hide():i.val("").show(),i.length&&(i[0].options.length=1),$.get(url+"api/village",{q:a.val()+o.val()+n.val()},function(t){for(let e=0;e<t.length;e++)i.append($("<option></option>").text(t[e].label).val(t[e].village))},"json"),"submit"==e.data("change")&&t.submit())}),$(document).on("change",".sg-village",function(){var e=$(this),t=e.closest("form"),a=t.find(".sg-changwat"),o=t.find(".sg-ampur"),n=t.find(".sg-tambon");t.find(".sg-village");a.data("altfld")&&$(a.data("altfld")).val(a.val()+o.val()+n.val()+e.val()),"submit"==e.data("change")&&t.submit()});var sgDrawMap=function(o,e={}){var n,i=$.extend({},{gisDigit:14,zoom:9,center:[],drag:"pin",dropPin:!1,dropPinText:null,updateUrl:null,updatePara:null,updateIcon:null,mapCanvas:"#map-canvas",height:"100%",pin:[],markers:[],debug:!1,callback:!1},e);i.debug&&console.log(i);var t=$("#current-location .value"),a=i.updateUrl,l=!!i.pin.lat,s="",r=("map"==i.drag?"เลื่อนแผนที่":"ลากหมุด")+"เพื่อเปลี่ยนตำแหน่ง";$(".box-page").css({width:"100%",height:"100%",minWidth:"100%",minHeight:"100%"}),$(".page.-map").css({height:i.height,minWidth:"100%",minHeight:i.height}),$(i.mapCanvas).css({width:"100%",height:"100%",minWidth:"100%",minHeight:"100%"}),i.dropPin?l?notify(r,2e4):l||notify("คลิกบนแผนที่ตรงตำแหน่งที่ต้องการวางหมุด",2e4):l=!0;var d=new GMaps({div:i.mapCanvas,zoom:i.zoom,scrollwheel:!0,lat:i.center.lat,lng:i.center.lng,click:function(e){l||(notify(r,2e4),n=e.latLng.lat().toFixed(i.gisDigit)+","+e.latLng.lng().toFixed(i.gisDigit),u=g({lat:e.latLng.lat(),lng:e.latLng.lng()}),l=!0,new google.maps.InfoWindow({content:s}).open(d,u),t.text(n))}});"map"==i.drag&&d.addListener("center_changed",()=>{u&&(u.setPosition(d.getCenter()),p(d.getCenter().lat(),d.getCenter().lng()))});function c(o){if(null==a)return!1;var e=null==i.updatePara?{}:i.updatePara;e.location=o,i.debug&&console.log("SAVE Location "+a,e),$.post(a,e,function(e){var t="https://www.google.com/maps/place/"+o,a="geo:?q="+o;$("#googlemap").attr("href",t).removeClass("-hidden"),$("#googlenav").attr("href",a).removeClass("-hidden");a=""!=o?"-active":"";i.updateIcon&&$(i.updateIcon).removeClass("-active").addClass(a),notify("บันทึกเรียบร้อย"+e,3e3)})}var u;function p(e,t){var a=$("#current-location");a.find(".value").text(e.toFixed(i.gisDigit)+","+t.toFixed(i.gisDigit)),a.find(".show").text(e.toFixed(4)+","+t.toFixed(4))}function g(e){n=e.lat.toFixed(i.gisDigit)+","+e.lng.toFixed(i.gisDigit);var t='<nav class="nav -sg-flex"><a class="sg-action btn -link -cancel" href="#current-location" data-rel="none" data-title="ลบหมุด" data-confirm="ลบหมุด กรุณายืนยัน?" data-done="javascript:'+o+'.clearMap()"><i class="icon -material">cancel</i><span>ลบหมุด</span></a><a class="btn -primary" onClick=\''+o+'.locationUpdate($("#current-location>.value").text());return false;\'><i class="icon -material">done</i><span>บันทึกตำแหน่ง</span></a></nav>',a="";return e.currentLocation&&null!=i.locationText?a=i.locationText:i.pin&&null!=i.pin.content&&(a=i.pin.content),s='<div class="map-info">'+a+(i.updateUrl?t:"")+'<div id="current-location" class="current-location">พิกัด <span class="value -hidden">'+n+'</span><span class="show">'+e.lat.toFixed(4)+","+e.lng.toFixed(4)+'</span>\x3c!-- TODO:: <a class="btn -link" style="padding: 2px 4px 2px 8px; margin-left: 8px;" onClick=\''+o+'.editLocation($("#current-location>.value").text());return false;\'><i class="icon -material -sg-16">edit</i><span>แก้ไข</span></a> --\x3e</div></div>',d.addMarker({lat:e.lat,lng:e.lng,draggable:"map"!=i.drag,infoWindow:{title:i.pin.title,content:s},dragend:function(e){p(e.latLng.lat(),e.latLng.lng())}})}return i.pin.lat&&i.pin.lng&&(u=g(i.pin),new google.maps.InfoWindow({content:s}).open(d,u)),i.markers&&$.each(i.markers,function(e,t){t.lat&&t.lng&&d.addMarker({lat:t.lat,lng:t.lng,draggable:null!=t.draggable&&t.draggable,icon:null==t.icon?"https://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=|CCCCCC|FFFFFF":t.icon,infoWindow:{content:null==t.content?"":t.content}})}),$("#getgis").click(function(){return notify("กำลังหาตำแหน่งปัจจุบัน"),navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){notify(),d.setCenter({lat:e.coords.latitude,lng:e.coords.longitude}),null==u&&(u=g({lat:e.coords.latitude,lng:e.coords.longitude,currentLocation:!0}),new google.maps.InfoWindow({content:s}).open(d,u),l=!0),u.setPosition(d.getCenter()),p(e.coords.latitude,e.coords.longitude)},function(){notify("Error: The Geolocation service failed.",5e3)}):notify("Error: Browser doesnt support Geolocation.",5e3),!1}),{clearMap:function(){l=!1,c(""),u.setMap(null)},locationUpdate:c,editLocation:function(e){if(null==a)return!1;console.log("EDIT",e)},currentMarker:function(){return n},settings:i}};